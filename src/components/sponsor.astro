---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';

interface Props {
	handle: string;
	href: string;
	name?: string;
}

const { handle, href, name } = Astro.props;

// match two files per sponsor: <handle>.light.svg and <handle>.dark.svg
const logos = import.meta.glob<{ default: ImageMetadata }>('../assets/sponsors/*.{svg,svg}');
const lightKey = `../assets/sponsors/${handle}.light.svg`;
const darkKey = `../assets/sponsors/${handle}.dark.svg`;

// fall back to single-file <handle>.svg if themed variants missing
const fallbackKey = `../assets/sponsors/${handle}.svg`;

const haveLight = Boolean(logos[lightKey]);
const haveDark = Boolean(logos[darkKey]);
const haveFallback = Boolean(logos[fallbackKey]);

if (!haveLight && !haveDark && !haveFallback) {
  throw new Error(`Could not resolve sponsor logo for @${handle}`);
}

const load = async (key: string) => (logos[key] ? (await logos[key]()).default : null);

const lightSrc = (haveLight ? await load(lightKey) : haveFallback ? await load(fallbackKey) : null);
const darkSrc = (haveDark ? await load(darkKey) : haveFallback ? await load(fallbackKey) : null);
---

<li class="sponsor">
	<div class="logo-wrap" aria-hidden="true">
    <a href={href} aria-label=`${name} website`>
      {lightSrc && darkSrc ? (
        <Image class="logo dark:sl-hidden print:block" src={lightSrc} alt={name ? `${name} logo` : `${handle} logo`} />
        <Image class="logo light:sl-hidden print:hidden" src={darkSrc} alt={name ? `${name} logo` : `${handle} logo`} />
      ) : (
        <Image class="logo print:block" src={lightSrc ?? darkSrc!} alt={name ? `${name} logo` : `${handle} logo`} />
			)}
		</a>
	</div>
	{name && (
  <div>
    <p class="sponsor-name">{name}</p>
  </div>
	)}
</li>

<style>
	.sponsor {
		display: flex;
		flex-direction: column;
		gap: 0.25em;
    align-items: center;
	}
	.logo-wrap {
		display: flex;
		gap: 1rem;
		align-items: center;
	}
	.logo {
		width: 20em;
		height: 5em;
	}
	.sponsor-name {
		font-weight: 600;
		font-size: var(--sl-text-h4);
		color: var(--sl-color-white);
		line-height: var(--sl-line-height-headings);
	}
</style>
